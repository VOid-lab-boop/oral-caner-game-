<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oral Health Runner - Cancer Awareness Game</title>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
        }

        #gameContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
        }

        #ui {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }

        .ui-element {
            pointer-events: auto;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .game-button {
            background: #5D5CDE;
            color: white;
            padding: 16px 48px;
            border-radius: 12px;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
            animation: pulse 2s infinite;
        }

        .game-button:hover {
            background: #4a49c5;
            transform: translateY(-2px);
        }

        .health-bad { color: #ef4444; }
        .health-warning { color: #f59e0b; }
        .health-good { color: #10b981; }

        .hidden { display: none !important; }

        #startScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 200;
        }

        .modal-box {
            background: white;
            border-radius: 24px;
            padding: 48px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
        }

        .modal-box h1 {
            font-size: 3rem;
            font-weight: 900;
            color: #5D5CDE;
            margin-bottom: 24px;
        }

        .modal-box p {
            color: #555;
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- Start Screen -->
    <div id="startScreen">
        <div class="modal-box">
            <h1>ü¶∑ Oral Health Runner</h1>
            <p>
                Run and collect <strong>healthy foods</strong> ü•ó and <strong>toothbrushes</strong> ü™• while avoiding <strong>cigarettes</strong> üö¨ and <strong>fast food</strong> üçî.
            </p>
            <p>
                Your mouth will grow larger when you consume harmful items - simulating <strong>oral cancer progression</strong>.
            </p>
            <p style="color: #ef4444; font-weight: 700;">
                ‚ö†Ô∏è 3 bad items in a row = Immediate Game Over!
            </p>
            <button onclick="startGame()" class="game-button">
                üéÆ Start Game
            </button>
        </div>
    </div>

    <!-- Game Container -->
    <div id="gameContainer"></div>

    <!-- UI Overlay -->
    <div id="ui">
        <!-- HUD -->
        <div id="hud" class="hidden ui-element" style="position: absolute; top: 20px; left: 20px;">
            <div style="background: rgba(255,255,255,0.95); border-radius: 16px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                <div style="display: flex; gap: 32px; font-size: 16px;">
                    <div>
                        <div style="color: #666; margin-bottom: 4px; font-size: 14px;">Time</div>
                        <div id="timer" style="font-size: 28px; font-weight: bold; color: #000;">60s</div>
                    </div>
                    <div>
                        <div style="color: #666; margin-bottom: 4px; font-size: 14px;">Health</div>
                        <div id="health" class="health-good" style="font-size: 28px; font-weight: bold;">100%</div>
                    </div>
                    <div>
                        <div style="color: #666; margin-bottom: 4px; font-size: 14px;">Bad Streak</div>
                        <div id="streak" style="font-size: 28px; font-weight: bold; color: #000;">0/3</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Instructions -->
        <div id="instructions" class="hidden ui-element" style="position: absolute; bottom: 24px; left: 50%; transform: translateX(-50%);">
            <div style="background: rgba(255,255,255,0.95); border-radius: 16px; padding: 16px 32px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                <p style="font-weight: 700; margin-bottom: 8px; font-size: 16px; color: #000;">Use Arrow Keys ‚¨ÖÔ∏è ‚û°Ô∏è or Swipe to Move</p>
                <p style="font-size: 14px; color: #666; margin: 0;">ü•ó Healthy = +15% | ü™• Toothbrush = +20% | üö¨ Cigarette = -20% | üçî Fast Food = -15%</p>
            </div>
        </div>

        <!-- Game Over -->
        <div id="gameOverScreen" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center; z-index: 300;">
            <div class="modal-box">
                <h2 id="gameOverTitle" style="font-size: 2.5rem; font-weight: bold; margin-bottom: 24px;"></h2>
                <p id="gameOverMessage" style="color: #555; font-size: 18px; margin-bottom: 32px;"></p>
                <div style="background: #f5f5f5; border-radius: 12px; padding: 20px; margin-bottom: 32px;">
                    <div style="font-size: 14px; color: #666; margin-bottom: 8px;">Final Health</div>
                    <div id="finalHealth" style="font-size: 36px; font-weight: bold;"></div>
                </div>
                <button onclick="restartGame()" class="game-button">
                    üîÑ Play Again
                </button>
            </div>
        </div>
    </div>

    <script>
        let scene, camera, renderer, player, items = [];
        let gameRunning = false;
        let health = 100, badStreak = 0, timeLeft = 60, gameTime = 0;
        let currentLane = 1, lastSpawnTime = 0;

        const LANE_WIDTH = 2.5;
        const LANES = [-LANE_WIDTH, 0, LANE_WIDTH];
        const ITEM_SPEED = 0.20; // Good pace
        const SPAWN_INTERVAL = 2.0; // Reasonable spawning

        const ITEM_TYPES = {
            healthy: { color: 0x10b981, health: 15 },
            toothbrush: { color: 0x3b82f6, health: 20 },
            cigarette: { color: 0xef4444, health: -20 },
            fastfood: { color: 0xf59e0b, health: -15 }
        };

        function init3D() {
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);
            scene.fog = new THREE.Fog(0x87CEEB, 20, 60);

            // Camera
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.set(0, 6, 10);
            camera.lookAt(0, 0, 0);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;
            document.getElementById('gameContainer').appendChild(renderer.domElement);

            // Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
            scene.add(ambientLight);

            const sunLight = new THREE.DirectionalLight(0xffffff, 0.8);
            sunLight.position.set(10, 20, 10);
            sunLight.castShadow = true;
            sunLight.shadow.camera.left = -20;
            sunLight.shadow.camera.right = 20;
            sunLight.shadow.camera.top = 20;
            sunLight.shadow.camera.bottom = -20;
            scene.add(sunLight);

            // Ground
            const groundGeo = new THREE.PlaneGeometry(100, 100);
            const groundMat = new THREE.MeshStandardMaterial({ color: 0x228B22 });
            const ground = new THREE.Mesh(groundGeo, groundMat);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);

            // Road
            for (let i = 0; i < 40; i++) {
                const roadGeo = new THREE.PlaneGeometry(8, 3);
                const roadMat = new THREE.MeshStandardMaterial({
                    color: i % 2 === 0 ? 0x333333 : 0x444444
                });
                const road = new THREE.Mesh(roadGeo, roadMat);
                road.rotation.x = -Math.PI / 2;
                road.position.set(0, 0.01, -i * 3);
                road.receiveShadow = true;
                road.userData.isRoad = true;
                scene.add(road);
            }

            // Lane lines
            for (let lane = 0; lane < 2; lane++) {
                for (let i = 0; i < 60; i++) {
                    const lineGeo = new THREE.BoxGeometry(0.15, 0.1, 1);
                    const lineMat = new THREE.MeshStandardMaterial({ color: 0xffff00 });
                    const line = new THREE.Mesh(lineGeo, lineMat);
                    line.position.set(LANES[lane] + LANE_WIDTH / 2, 0.05, -i * 2.5);
                    line.userData.isLine = true;
                    scene.add(line);
                }
            }

            createPlayer();

            // Events
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

            document.addEventListener('keydown', (e) => {
                if (!gameRunning) return;
                if (e.key === 'ArrowLeft' && currentLane > 0) currentLane--;
                if (e.key === 'ArrowRight' && currentLane < 2) currentLane++;
            });

            let touchStartX = 0;
            document.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
            });
            document.addEventListener('touchend', (e) => {
                if (!gameRunning) return;
                const diff = e.changedTouches[0].clientX - touchStartX;
                if (Math.abs(diff) > 50) {
                    if (diff > 0 && currentLane < 2) currentLane++;
                    if (diff < 0 && currentLane > 0) currentLane--;
                }
            });

            animate();
        }

        function createPlayer() {
            player = new THREE.Group();

            // Legs
            const legGeo = new THREE.CylinderGeometry(0.15, 0.15, 0.9, 12);
            const legMat = new THREE.MeshStandardMaterial({ color: 0x2c3e50 });

            const leftLeg = new THREE.Mesh(legGeo, legMat);
            leftLeg.position.set(-0.2, -0.45, 0);
            leftLeg.castShadow = true;
            player.add(leftLeg);

            const rightLeg = new THREE.Mesh(legGeo, legMat);
            rightLeg.position.set(0.2, -0.45, 0);
            rightLeg.castShadow = true;
            player.add(rightLeg);

            // Torso
            const torsoGeo = new THREE.BoxGeometry(0.8, 1.0, 0.4);
            const torsoMat = new THREE.MeshStandardMaterial({ color: 0x3498db });
            const torso = new THREE.Mesh(torsoGeo, torsoMat);
            torso.position.y = 0.5;
            torso.castShadow = true;
            player.add(torso);

            // Arms
            const armGeo = new THREE.CylinderGeometry(0.12, 0.12, 0.8, 12);
            const armMat = new THREE.MeshStandardMaterial({ color: 0xffdbac });

            const leftArm = new THREE.Mesh(armGeo, armMat);
            leftArm.position.set(-0.5, 0.4, 0);
            leftArm.rotation.z = 0.3;
            leftArm.castShadow = true;
            player.add(leftArm);

            const rightArm = new THREE.Mesh(armGeo, armMat);
            rightArm.position.set(0.5, 0.4, 0);
            rightArm.rotation.z = -0.3;
            rightArm.castShadow = true;
            player.add(rightArm);

            // Neck
            const neckGeo = new THREE.CylinderGeometry(0.15, 0.15, 0.2, 12);
            const neckMat = new THREE.MeshStandardMaterial({ color: 0xffdbac });
            const neck = new THREE.Mesh(neckGeo, neckMat);
            neck.position.y = 1.1;
            neck.castShadow = true;
            player.add(neck);

            // Head
            const headGeo = new THREE.SphereGeometry(0.35, 24, 24);
            const headMat = new THREE.MeshStandardMaterial({ color: 0xffdbac });
            const head = new THREE.Mesh(headGeo, headMat);
            head.position.y = 1.45;
            head.castShadow = true;
            player.add(head);

            // Hair
            const hairGeo = new THREE.SphereGeometry(0.37, 16, 16, 0, Math.PI * 2, 0, Math.PI / 2);
            const hairMat = new THREE.MeshStandardMaterial({ color: 0x2c1810 });
            const hair = new THREE.Mesh(hairGeo, hairMat);
            hair.position.y = 1.6;
            hair.castShadow = true;
            player.add(hair);

            // Eyes
            const eyeGeo = new THREE.SphereGeometry(0.08, 12, 12);
            const eyeMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
            const pupilMat = new THREE.MeshStandardMaterial({ color: 0x000000 });

            const leftEye = new THREE.Mesh(eyeGeo, eyeMat);
            leftEye.position.set(-0.12, 1.5, 0.3);
            player.add(leftEye);

            const leftPupil = new THREE.Mesh(new THREE.SphereGeometry(0.04, 8, 8), pupilMat);
            leftPupil.position.set(-0.12, 1.5, 0.36);
            player.add(leftPupil);

            const rightEye = new THREE.Mesh(eyeGeo, eyeMat);
            rightEye.position.set(0.12, 1.5, 0.3);
            player.add(rightEye);

            const rightPupil = new THREE.Mesh(new THREE.SphereGeometry(0.04, 8, 8), pupilMat);
            rightPupil.position.set(0.12, 1.5, 0.36);
            player.add(rightPupil);

            // Nose
            const noseGeo = new THREE.ConeGeometry(0.06, 0.12, 8);
            const noseMat = new THREE.MeshStandardMaterial({ color: 0xffdbac });
            const nose = new THREE.Mesh(noseGeo, noseMat);
            nose.position.set(0, 1.4, 0.35);
            nose.rotation.x = Math.PI / 2;
            player.add(nose);

            // Mouth (will grow/shrink)
            const mouthGeo = new THREE.SphereGeometry(0.18, 16, 16);
            const mouthMat = new THREE.MeshStandardMaterial({ color: 0xff3333 });
            const mouth = new THREE.Mesh(mouthGeo, mouthMat);
            mouth.position.set(0, 1.25, 0.32);
            mouth.scale.set(1.2, 0.5, 0.6);
            player.add(mouth);
            player.userData.mouth = mouth;
            player.userData.mouthScale = 1;

            player.position.set(0, 0.9, 3);
            scene.add(player);
        }

        function createHealthyFood() {
            const group = new THREE.Group();

            // Apple shape
            const bodyGeo = new THREE.SphereGeometry(0.35, 16, 16);
            const bodyMat = new THREE.MeshStandardMaterial({ color: 0xff4444 });
            const body = new THREE.Mesh(bodyGeo, bodyMat);
            body.scale.set(1, 0.9, 1);
            body.castShadow = true;
            group.add(body);

            // Stem
            const stemGeo = new THREE.CylinderGeometry(0.04, 0.04, 0.2, 8);
            const stemMat = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
            const stem = new THREE.Mesh(stemGeo, stemMat);
            stem.position.y = 0.35;
            group.add(stem);

            // Leaf
            const leafGeo = new THREE.CircleGeometry(0.12, 8);
            const leafMat = new THREE.MeshStandardMaterial({ color: 0x22aa22, side: THREE.DoubleSide });
            const leaf = new THREE.Mesh(leafGeo, leafMat);
            leaf.position.set(0.1, 0.4, 0);
            leaf.rotation.y = Math.PI / 4;
            group.add(leaf);

            return group;
        }

        function createToothbrush() {
            const group = new THREE.Group();

            // Handle
            const handleGeo = new THREE.CylinderGeometry(0.08, 0.08, 1.0, 12);
            const handleMat = new THREE.MeshStandardMaterial({ color: 0x3b82f6 });
            const handle = new THREE.Mesh(handleGeo, handleMat);
            handle.rotation.z = Math.PI / 2;
            handle.castShadow = true;
            group.add(handle);

            // Brush head
            const headGeo = new THREE.BoxGeometry(0.25, 0.12, 0.15);
            const headMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
            const head = new THREE.Mesh(headGeo, headMat);
            head.position.x = 0.6;
            head.castShadow = true;
            group.add(head);

            // Bristles
            for (let i = 0; i < 5; i++) {
                const bristleGeo = new THREE.BoxGeometry(0.04, 0.15, 0.04);
                const bristleMat = new THREE.MeshStandardMaterial({ color: 0x00ffff });
                const bristle = new THREE.Mesh(bristleGeo, bristleMat);
                bristle.position.set(0.5 + i * 0.05, 0.1, 0);
                group.add(bristle);
            }

            return group;
        }

        function createCigarette() {
            const group = new THREE.Group();

            // Cigarette body
            const bodyGeo = new THREE.CylinderGeometry(0.06, 0.06, 0.9, 16);
            const bodyMat = new THREE.MeshStandardMaterial({ color: 0xeeeeee });
            const body = new THREE.Mesh(bodyGeo, bodyMat);
            body.rotation.z = Math.PI / 6;
            body.castShadow = true;
            group.add(body);

            // Filter (orange/brown part)
            const filterGeo = new THREE.CylinderGeometry(0.06, 0.06, 0.2, 16);
            const filterMat = new THREE.MeshStandardMaterial({ color: 0xd97706 });
            const filter = new THREE.Mesh(filterGeo, filterMat);
            filter.position.set(-0.47, -0.08, 0);
            filter.rotation.z = Math.PI / 6;
            group.add(filter);

            // Burning tip
            const tipGeo = new THREE.CylinderGeometry(0.06, 0.05, 0.1, 16);
            const tipMat = new THREE.MeshStandardMaterial({
                color: 0xff4400,
                emissive: 0xff2200,
                emissiveIntensity: 0.6
            });
            const tip = new THREE.Mesh(tipGeo, tipMat);
            tip.position.set(0.47, 0.08, 0);
            tip.rotation.z = Math.PI / 6;
            group.add(tip);

            return group;
        }

        function createFastFood() {
            const group = new THREE.Group();

            // Bottom bun
            const bottomBunGeo = new THREE.CylinderGeometry(0.35, 0.3, 0.15, 20);
            const bunMat = new THREE.MeshStandardMaterial({ color: 0xdaa520 });
            const bottomBun = new THREE.Mesh(bottomBunGeo, bunMat);
            bottomBun.position.y = -0.2;
            bottomBun.castShadow = true;
            group.add(bottomBun);

            // Patty
            const pattyGeo = new THREE.CylinderGeometry(0.32, 0.32, 0.12, 20);
            const pattyMat = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
            const patty = new THREE.Mesh(pattyGeo, pattyMat);
            patty.position.y = -0.08;
            group.add(patty);

            // Cheese
            const cheeseGeo = new THREE.CylinderGeometry(0.34, 0.34, 0.05, 20);
            const cheeseMat = new THREE.MeshStandardMaterial({ color: 0xffd700 });
            const cheese = new THREE.Mesh(cheeseGeo, cheeseMat);
            cheese.position.y = 0;
            group.add(cheese);

            // Lettuce
            const lettuceGeo = new THREE.CylinderGeometry(0.33, 0.33, 0.08, 20);
            const lettuceMat = new THREE.MeshStandardMaterial({ color: 0x90ee90 });
            const lettuce = new THREE.Mesh(lettuceGeo, lettuceMat);
            lettuce.position.y = 0.08;
            group.add(lettuce);

            // Top bun
            const topBunGeo = new THREE.SphereGeometry(0.35, 20, 20, 0, Math.PI * 2, 0, Math.PI / 2);
            const topBun = new THREE.Mesh(topBunGeo, bunMat);
            topBun.position.y = 0.25;
            topBun.castShadow = true;
            group.add(topBun);

            // Sesame seeds
            const seedGeo = new THREE.SphereGeometry(0.03, 8, 8);
            const seedMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
            for (let i = 0; i < 8; i++) {
                const seed = new THREE.Mesh(seedGeo, seedMat);
                const angle = (i / 8) * Math.PI * 2;
                seed.position.set(
                    Math.cos(angle) * 0.25,
                    0.35,
                    Math.sin(angle) * 0.25
                );
                group.add(seed);
            }

            return group;
        }

        function createItem(type) {
            let itemMesh;

            switch(type) {
                case 'healthy':
                    itemMesh = createHealthyFood();
                    break;
                case 'toothbrush':
                    itemMesh = createToothbrush();
                    break;
                case 'cigarette':
                    itemMesh = createCigarette();
                    break;
                case 'fastfood':
                    itemMesh = createFastFood();
                    break;
            }

            const lane = LANES[Math.floor(Math.random() * 3)];
            itemMesh.position.set(lane, 0.5, -30);
            itemMesh.userData.type = type;
            itemMesh.userData.collected = false;

            scene.add(itemMesh);
            items.push(itemMesh);
        }

        function updateGame(delta) {
            if (!gameRunning) return;

            gameTime += delta;
            timeLeft -= delta;

            if (timeLeft <= 0) {
                endGame(health >= 50, 'timeout');
                return;
            }

            // Move player
            const targetX = LANES[currentLane];
            player.position.x += (targetX - player.position.x) * 0.15;

            // Running animation
            const runSpeed = gameTime * 10;
            player.children.forEach((child, idx) => {
                if (child.geometry && child.geometry.type === 'CylinderGeometry' && child.position.y < 0) {
                    // Animate legs
                    child.rotation.x = Math.sin(runSpeed + idx) * 0.3;
                }
            });

            // Spawn items
            lastSpawnTime += delta;
            if (lastSpawnTime >= SPAWN_INTERVAL) {
                const types = Object.keys(ITEM_TYPES);
                createItem(types[Math.floor(Math.random() * types.length)]);
                lastSpawnTime = 0;
            }

            // Update items
            for (let i = items.length - 1; i >= 0; i--) {
                const item = items[i];
                item.position.z += ITEM_SPEED;
                item.rotation.y += 0.05;

                // Collision
                if (!item.userData.collected &&
                    Math.abs(item.position.x - player.position.x) < 0.7 &&
                    Math.abs(item.position.z - player.position.z) < 1.2) {
                    collectItem(item);
                }

                // Remove
                if (item.position.z > 8) {
                    scene.remove(item);
                    items.splice(i, 1);
                }
            }

            // Scroll road
            scene.children.forEach(child => {
                if (child.userData.isRoad || child.userData.isLine) {
                    child.position.z += ITEM_SPEED;
                    if (child.position.z > 15) {
                        child.position.z -= 120;
                    }
                }
            });

            updateHUD();
        }

        function collectItem(item) {
            item.userData.collected = true;
            const type = item.userData.type;
            const change = ITEM_TYPES[type].health;

            health = Math.max(0, Math.min(100, health + change));

            if (change < 0) {
                badStreak++;
                player.userData.mouthScale = Math.min(3.5, player.userData.mouthScale + 0.4);
            } else {
                badStreak = 0;
                player.userData.mouthScale = Math.max(1, player.userData.mouthScale - 0.25);
            }

            player.userData.mouth.scale.set(
                player.userData.mouthScale * 1.2,
                player.userData.mouthScale * 0.5,
                player.userData.mouthScale * 0.6
            );

            item.scale.set(0, 0, 0);

            if (badStreak >= 3) {
                endGame(false, 'cancer');
            }
        }

        function updateHUD() {
            document.getElementById('timer').textContent = Math.ceil(timeLeft) + 's';
            const healthEl = document.getElementById('health');
            healthEl.textContent = Math.round(health) + '%';
            healthEl.className = health >= 70 ? 'health-good' : health >= 40 ? 'health-warning' : 'health-bad';
            document.getElementById('streak').textContent = badStreak + '/3';
        }

        function startGame() {
            console.log('Starting game...');
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('hud').classList.remove('hidden');
            document.getElementById('instructions').classList.remove('hidden');

            gameRunning = true;
            health = 100;
            badStreak = 0;
            timeLeft = 60;
            gameTime = 0;
            currentLane = 1;
            lastSpawnTime = 0;

            // Reset player position and mouth
            player.position.x = 0;
            player.userData.mouthScale = 1;
            player.userData.mouth.scale.set(1.2, 0.5, 0.6);

            // Clear all items
            items.forEach(item => scene.remove(item));
            items = [];

            updateHUD();
        }

        function endGame(survived, reason) {
            gameRunning = false;
            document.getElementById('gameOverScreen').classList.remove('hidden');
            document.getElementById('instructions').classList.add('hidden');

            const title = document.getElementById('gameOverTitle');
            const message = document.getElementById('gameOverMessage');

            if (reason === 'cancer') {
                title.textContent = 'üò¢ Oral Cancer Developed';
                title.style.color = '#ef4444';
                message.textContent = 'You consumed 3 harmful items in a row. Smoking and poor diet significantly increase oral cancer risk!';
            } else if (survived) {
                title.textContent = 'üéâ You Survived!';
                title.style.color = '#10b981';
                message.textContent = 'Great job! Keep choosing healthy foods and avoiding tobacco to reduce cancer risk.';
            } else {
                title.textContent = '‚è∞ Time\'s Up!';
                title.style.color = '#f59e0b';
                message.textContent = health >= 50
                    ? 'You finished, but watch your oral health!'
                    : 'Poor oral health! Remember: smoking and junk food increase cancer risk.';
            }

            document.getElementById('finalHealth').textContent = Math.round(health) + '%';
            document.getElementById('finalHealth').className =
                health >= 70 ? 'health-good' : health >= 40 ? 'health-warning' : 'health-bad';
        }

        function restartGame() {
            document.getElementById('gameOverScreen').classList.add('hidden');
            startGame();
        }

        let lastTime = 0;
        function animate(time = 0) {
            requestAnimationFrame(animate);
            const delta = (time - lastTime) / 1000;
            lastTime = time;

            updateGame(delta);
            renderer.render(scene, camera);
        }

        // Initialize when page loads
        window.onload = () => {
            init3D();
        };
    </script>
</body>
</html>
